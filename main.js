const e=new class{#e=[];#t=new Map;#r=[];#n=[];#i=!1;#s=!1;#o=null;timeScale=1;FIXED_DT=1/60;MAX_STEPS=5;MAX_COMPONENT_STEPS=5;constructor(){document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState?this.pause():this.resume()}))}get(){return this.#e}register(e){this.#e.push(e)}registerAll(e){this.#e.push(...e)}add(e){const t=e.priority??0;this.#t.has(t)||this.#t.set(t,new Set);const r=performance.now();e.__lastTime=r,e.__accumulator=0,e.deltaTime=e.fps>0?1/e.fps:1/0,this.#t.get(t).add(e),this.#a(),this.#l(e),this.#h()}remove(e){for(const t of this.#t.values())t.delete(e);for(const t of this.#n)t.__querySet?.delete(e);this.#h()}#a(){this.#r=[...this.#t.entries()].sort((([e],[t])=>e-t))}addSystem(e){e.__accumulator=0,e.__lastTime=performance.now(),e.query&&(e.__querySet=this.#u(e.query)),this.#n.push(e),this.#n.sort(((e,t)=>e.priority-t.priority)),this.start()}#u(e){const t=new Set;for(const[,r]of this.#r)for(const n of r)this.#c(n,e)&&t.add(n);return t}#c(e,t){if(t.type&&!(e instanceof t.type))return!1;if(t.tags)for(const r of t.tags)if(!e.tags?.has(r))return!1;return!(t.where&&!t.where(e))}notifyComponentChanged(e){for(const t of this.#n){if(!t.query)continue;const r=this.#c(e,t.query),n=t.__querySet;r?n.add(e):n.delete(e)}}#l(e){for(const t of this.#n)t.query&&this.#c(e,t.query)&&t.__querySet.add(e)}start(){this.#i||(this.#i=!0,this.#s=!1,this.#o=requestAnimationFrame(this.#d))}pause(){this.#i&&!this.#s&&(this.#s=!0,cancelAnimationFrame(this.#o),this.#o=null)}resume(){if(!this.#i||!this.#s)return;const e=performance.now();for(const[,t]of this.#r)for(const r of t)r.__lastTime=e,r.__accumulator=0;for(const t of this.#n)t.__lastTime=e,t.__accumulator=0;this.#s=!1,this.#o=requestAnimationFrame(this.#d)}#f(){for(const[,e]of this.#r)for(const t of e)if(!t.paused&&t.visible&&t.fps>0)return!0;return this.#n.length>0}#h(){this.#f()?this.start():this.pause()}#d=e=>{if(this.#i&&!this.#s)if(this.#f()){for(const t of this.#n){const r=(e-t.__lastTime)/1e3;t.__lastTime=e,t.__accumulator+=r*this.timeScale;let n=0;for(;t.__accumulator>=this.FIXED_DT&&n<this.MAX_STEPS;)t.update?.(this.FIXED_DT,t.__querySet??null),t.__accumulator-=this.FIXED_DT,n++;n===this.MAX_STEPS&&(t.__accumulator=0)}for(const[,t]of this.#r)for(const r of t){if(r.paused||!r.visible||r.fps<=0)continue;const t=(e-r.__lastTime)/1e3;r.__lastTime=e,r.__accumulator+=t*this.timeScale;let n=0;for(;r.__accumulator>=r.deltaTime&&n<this.MAX_COMPONENT_STEPS;)r.__accumulator-=r.deltaTime,r.inProcess?.(r.shadowRoot),n++;n===this.MAX_COMPONENT_STEPS&&(r.__accumulator=0)}this.#o=requestAnimationFrame(this.#d)}else this.pause()}};function t(e,r){return r?Object.entries(e).reduce(((e,[n,i])=>{if(!(n in r))return e[n]=i,e;const s=r[n];return"object"!=typeof i||null===i||Array.isArray(i)||"object"!=typeof s||null===s||Array.isArray(s)?e[n]=s:e[n]=t(i,s),e}),{}):e}class r{#p=null;#m={};#g=null;constructor(e,t){this.#p=e,this.#m=t.config,this.#g=this.#y(),this.#m.files.html.absolutePath=this.toAbsolutePath(this.#m?.files?.html?.path,this.#g),this.#m.files.css.absolutePath=this.toAbsolutePath(this.#m?.files?.css?.path,this.#g)}#y(){try{const e=`${this.#p}.js`,t=((new Error).stack||"").split("\n").find((t=>t.includes(e)));if(t){const e=t.match(/(?:https?|file):\/\/[^\s)]+/);if(e)return e[0].replace(/[^/]+$/,"")}}catch{}return document.baseURI}toAbsolutePath(e,t){if(!e)return"";if(!t)return e;if(/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(e))return e;try{return new URL(e,t).href}catch(e){console.error("Error converting to absolute path:",e)}}getAbsolutePath(){return this.#g}get(e){return t=this.#m,(r=e)?Object.fromEntries(Object.entries(t).filter((([e])=>r.includes(e)))):t;var t,r}set(e){this.#m=t(this.#m,e)}setHTMLContent(e){this.#m.files.html.content=e}setCSSContent(e){this.#m.files.css.content=e}isLazyLoading(){return this.#m?.behavior?.lazyLoading}isDebugMode(){return this.#m?.behavior?.debug}}class n{group={message:"",style:["color: #41e179;","color: white; font-weight: normal;"]};logs={group:"LOG",message:[],style:["color:rgb(225, 225, 225);","color: white; font-weight: normal;"]};infos={group:"INFO",message:[],style:["color: #4169E1;","color: white; font-weight: normal;"]};warnings={group:"WARNING",message:[],style:["color:rgb(225, 206, 65);","color: white; font-weight: normal;"]};errors={group:"ERROR",message:[],style:["color:rgb(225, 65, 65);","color: white; font-weight: normal;"]};constructor(){}setGroup(e,t){this.group.message=`%c[${e}]%c :: ${t}`}log(e){this.logs.message.push(e)}info(e){this.infos.message.push(e)}warn(e){this.warnings.message.push(e)}error(e){this.errors.message.push(e)}groupLogs(e){e?.message?.length&&(console.groupCollapsed(`%c[${e.group}]%c: ${e.message.length} entries`,...e.style),e.message.forEach((e=>{console.log(e)})),console.groupEnd())}debug(){console.group(this.group.message,...this.group.style),this.groupLogs(this.logs),this.groupLogs(this.infos),this.groupLogs(this.warnings),this.groupLogs(this.errors),console.groupEnd()}}function i(e){return document.createRange().createContextualFragment(e)}function s(e){e instanceof Element&&e.replaceChildren()}function o(e){return e?e instanceof HTMLTemplateElement?Array.from(e.content.children):e instanceof Element?Array.from(e.children):[]:[]}function a(e,t="*"){const r=[...e.querySelectorAll(t)];for(const n of e.querySelectorAll("template"))r.push(...n.content.querySelectorAll(t));return r}const l=new Map,h=new Map;async function u(e){if(l.has(e))return l.get(e);const t=(async()=>{try{const t=await fetch(e);if(!t.ok)throw new Error(`Could not load file: ${e}`);return await t.text()}catch(e){throw console.error("loadFile error:",e),e}})();return l.set(e,t),t}function c(e,t,r={}){try{return new Function(...Object.keys(r),`"use strict"; return (${e});`).call(t,...Object.values(r))}catch(t){return void console.warn("compileExpression failed:",e,t)}}function d(e,t){return e&&e.includes("${")?e.replace(/\${(.*?)}/g,((e,r)=>c(r.trim(),t))):e}var f,p="undefined"==typeof document?void 0:document,m=!!p&&"content"in p.createElement("template"),g=!!p&&p.createRange&&"createContextualFragment"in p.createRange();function y(e,t){var r,n,i=e.nodeName,s=t.nodeName;return i===s||(r=i.charCodeAt(0),n=s.charCodeAt(0),r<=90&&n>=97?i===s.toUpperCase():n<=90&&r>=97&&s===i.toUpperCase())}function b(e,t,r){e[r]!==t[r]&&(e[r]=t[r],e[r]?e.setAttribute(r,""):e.removeAttribute(r))}var v={OPTION:function(e,t){var r=e.parentNode;if(r){var n=r.nodeName.toUpperCase();"OPTGROUP"===n&&(n=(r=r.parentNode)&&r.nodeName.toUpperCase()),"SELECT"!==n||r.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),r.selectedIndex=-1)}b(e,t,"selected")},INPUT:function(e,t){b(e,t,"checked"),b(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var r=t.value;e.value!==r&&(e.value=r);var n=e.firstChild;if(n){var i=n.nodeValue;if(i==r||!r&&i==e.placeholder)return;n.nodeValue=r}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var r,n,i=-1,s=0,o=e.firstChild;o;)if("OPTGROUP"===(n=o.nodeName&&o.nodeName.toUpperCase()))(o=(r=o).firstChild)||(o=r.nextSibling,r=null);else{if("OPTION"===n){if(o.hasAttribute("selected")){i=s;break}s++}!(o=o.nextSibling)&&r&&(o=r.nextSibling,r=null)}e.selectedIndex=i}}};function w(){}function E(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}const T=function(e,t,r){if(r||(r={}),"string"==typeof t)if("#document"===e.nodeName||"HTML"===e.nodeName){var n=t;(t=p.createElement("html")).innerHTML=n}else if("BODY"===e.nodeName){var i=t;(t=p.createElement("html")).innerHTML=i;var s=t.querySelector("body");s&&(t=s)}else o=(o=t).trim(),t=m?function(e){var t=p.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(o):g?function(e){return f||(f=p.createRange()).selectNode(p.body),f.createContextualFragment(e).childNodes[0]}(o):function(e){var t=p.createElement("body");return t.innerHTML=e,t.childNodes[0]}(o);else 11===t.nodeType&&(t=t.firstElementChild);var o,a=r.getNodeKey||E,l=r.onBeforeNodeAdded||w,h=r.onNodeAdded||w,u=r.onBeforeElUpdated||w,c=r.onElUpdated||w,d=r.onBeforeNodeDiscarded||w,b=r.onNodeDiscarded||w,T=r.onBeforeElChildrenUpdated||w,C=r.skipFromChildren||w,A=r.addChild||function(e,t){return e.appendChild(t)},S=!0===r.childrenOnly,L=Object.create(null),N=[];function P(e){N.push(e)}function _(e,t){if(1===e.nodeType)for(var r=e.firstChild;r;){var n=void 0;t&&(n=a(r))?P(n):(b(r),r.firstChild&&_(r,t)),r=r.nextSibling}}function R(e,t,r){!1!==d(e)&&(t&&t.removeChild(e),b(e),_(e,r))}function $(e){if(1===e.nodeType||11===e.nodeType)for(var t=e.firstChild;t;){var r=a(t);r&&(L[r]=t),$(t),t=t.nextSibling}}function x(e){h(e);for(var t=e.firstChild;t;){var r=t.nextSibling,n=a(t);if(n){var i=L[n];i&&y(t,i)?(t.parentNode.replaceChild(i,t),I(i,t)):x(t)}else x(t);t=r}}function I(e,t,r){var n=a(t);if(n&&delete L[n],!r){var i=u(e,t);if(!1===i)return;if(i instanceof HTMLElement&&$(e=i),function(e,t){var r,n,i,s,o=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var a=o.length-1;a>=0;a--)n=(r=o[a]).name,i=r.namespaceURI,s=r.value,i?(n=r.localName||n,e.getAttributeNS(i,n)!==s&&("xmlns"===r.prefix&&(n=r.name),e.setAttributeNS(i,n,s))):e.getAttribute(n)!==s&&e.setAttribute(n,s);for(var l=e.attributes,h=l.length-1;h>=0;h--)n=(r=l[h]).name,(i=r.namespaceURI)?(n=r.localName||n,t.hasAttributeNS(i,n)||e.removeAttributeNS(i,n)):t.hasAttribute(n)||e.removeAttribute(n)}}(e,t),c(e),!1===T(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var r,n,i,s,o,h=C(e,t),u=t.firstChild,c=e.firstChild;e:for(;u;){for(s=u.nextSibling,r=a(u);!h&&c;){if(i=c.nextSibling,u.isSameNode&&u.isSameNode(c)){u=s,c=i;continue e}n=a(c);var d=c.nodeType,f=void 0;if(d===u.nodeType&&(1===d?(r?r!==n&&((o=L[r])?i===o?f=!1:(e.insertBefore(o,c),n?P(n):R(c,e,!0),n=a(c=o)):f=!1):n&&(f=!1),(f=!1!==f&&y(c,u))&&I(c,u)):3!==d&&8!=d||(f=!0,c.nodeValue!==u.nodeValue&&(c.nodeValue=u.nodeValue))),f){u=s,c=i;continue e}n?P(n):R(c,e,!0),c=i}if(r&&(o=L[r])&&y(o,u))h||A(e,o),I(o,u);else{var m=l(u);!1!==m&&(m&&(u=m),u.actualize&&(u=u.actualize(e.ownerDocument||p)),A(e,u),x(u))}u=s,c=i}!function(e,t,r){for(;t;){var n=t.nextSibling;(r=a(t))?P(r):R(t,e,!0),t=n}}(e,c,n);var g=v[e.nodeName];g&&g(e,t)}(e,t):v.TEXTAREA(e,t)}$(e);var k,M,O=e,U=O.nodeType,q=t.nodeType;if(!S)if(1===U)1===q?y(e,t)||(b(e),O=function(e,t){for(var r=e.firstChild;r;){var n=r.nextSibling;t.appendChild(r),r=n}return t}(e,(k=t.nodeName,(M=t.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==M?p.createElementNS(M,k):p.createElement(k)))):O=t;else if(3===U||8===U){if(q===U)return O.nodeValue!==t.nodeValue&&(O.nodeValue=t.nodeValue),O;O=t}if(O===t)b(e);else{if(t.isSameNode&&t.isSameNode(O))return;if(I(O,t,S),N)for(var D=0,j=N.length;D<j;D++){var F=L[N[D]];F&&R(F,F.parentNode,!1)}}return!S&&O!==e&&e.parentNode&&(O.actualize&&(O=O.actualize(e.ownerDocument||p)),e.parentNode.replaceChild(O,e)),O};class C extends HTMLElement{fps=15;priority=0;paused=!1;visible=!1;tags=new Set;layer=0;DEFAULT_FPS=8;DEFAULT_PRIORITY=0;deltaTime=1/this.fps;__accumulator=0;__lastTime=performance.now();#m=null;shadowRoot=null;component;template=null;rawHTML=null;uuid=null;debug=null;#b=null;#v=null;#w=[];constructor(){super(),this.preProcess(),this.debug=new n,this.debug.info(`${this.constructor.name} has been instantiated.`)}#E(t){const r=e.get().map((e=>e.tag)).join("|"),n=new RegExp(`^<(${r})([^>]*?)\\s*/>`,"gm");return t.replace(n,((e,t,r)=>`<${t}${r}></${t}>`))}#T(){return this.#b?this.#b:this.#v?Promise.reject(this.#v):(this.#b=(async()=>{try{await this.#C()}catch(e){throw this.#v=e instanceof Error?e:new Error(String(e)),this.#v}})(),this.#b)}async#C(){try{const e=this.#m.get().files?.html?.path?.trim()?await u(this.#m.get().files.html.absolutePath):"",t=this.#m.get().files?.css?.path?.trim()?await u(this.#m.get().files.css.absolutePath):"";this.rawHTML=this.#A(e);let r=this.#E(this.rawHTML);this.#m.setHTMLContent(r.replace(/<!--[\s\S]*?-->/g,""),!0),this.#m.setCSSContent(t.replace(/\/\*[\s\S]*?\*\//g,"")),this.#S()}catch(e){this.debug.error(`Initialization error: ${e}`)}}#L(){return crypto.randomUUID()}#A(t){const r=e.get().map((e=>e.tag)).join("|"),n=new RegExp(`<(${r})(\\s[^>]*)?>`,"gi");return t.replace(n,((e,t,r="")=>{if(/\buuid\s*=/.test(r))return e;const n=this.#L(),i=r.trim();return i?`<${t} ${i} uuid="${n}">`:`<${t} uuid="${n}">`}))}retryProcess(){return this.#b=null,this.#v=null,this.#T()}async#S(){try{this.uuid=this.getAttribute("uuid"),this.hasAttribute("uuid")||(this.debug.info(`No UUID provided for ${this.constructor.name}. Generated a new one.`),this.uuid=this.#L(),this.setAttribute("uuid",this.uuid)),this.updateTemplate();const t=i(`<template><div> ${this.#m.get().files.html.content} </div></template>`).firstChild.content.firstElementChild;this.component=t,await this.toProcess(t),this.#N(t),this.#P(t),this.#_(t),this.shadowRoot.innerHTML=`\n                <style>\n                    ${d(this.#m.get().files.css.content,this)}\n                </style>\n                ${d(t.innerHTML,this)}\n            `,this.#R(this.shadowRoot),this.#$(this.shadowRoot),this.component=this.shadowRoot,await this.atProcess(this.shadowRoot),this.visible=!0,e.add(this)}catch(e){this.debug.error(`Error in Rendering component: ${e}`)}this.#m.isDebugMode()&&(this.debug.setGroup(this.constructor.name,this.uuid),this.debug.debug())}#x(e){if("string"!=typeof e)return{text:"",node:null};const t=(new DOMParser).parseFromString(e,"text/html").querySelector("template");return t?{text:t.innerHTML,node:t.content.cloneNode(!0)}:{text:"",node:null}}updateTemplate(e=this.innerHTML){e&&(this.template=this.#x(e),s(this))}updateHTMLContent(){try{const e=i(`<template><div> ${this.#m.get().files.html.content} </div></template>`).firstChild.content.firstElementChild;this.#N(e),this.#P(e),this.#_(e),e.innerHTML=`\n            <style>\n                ${d(this.#m.get().files.css.content,this)}\n            </style>\n            ${d(e.innerHTML,this)}\n        `,this.#R(e),this.#$(e),T(this.shadowRoot,e,{onBeforeNodeAdded:this.onBeforeNodeAdded}),this.component=this.shadowRoot}catch(e){this.debug.error(`Error in updating component: ${e}`)}}onBeforeNodeAdded=t=>{if(!(t instanceof Element))return;if(!t.matches(e.get().map((e=>e.tag)).join(",")))return;const r=t.querySelector("template");if(!r)return;const n=t.getAttribute("uuid");if(!n)return;const i=this.shadowRoot.querySelector(`[uuid="${n}"]`);if(!i)return;const s=r.innerHTML;return i.updateTemplate(s),"TEMPLATE"!==t.tagName&&t};#N(e){if(e)try{o(e).forEach(((e,t)=>{if(e.getAttribute("forEach")){const t=function(e){const t=new RegExp("(.*?)in(.*)"),r=e.match(t);return r?{firstItem:r[1],restItems:r[2]}:{firstItem:e,restItems:""}}(e.getAttribute("forEach").replace(/\${(.*?)}/g,"$1")),r=t.firstItem.trim(),n=c(t.restItems,this),o=i(e.innerHTML);s(e);for(let i=0;i<n.length;i++){const n=o.cloneNode(!0);n.querySelectorAll("*").forEach((e=>{Array.from(e.attributes).filter((e=>"object"==typeof e)).forEach((n=>{const s=n.value.match(/\$\{[^}]+\}/g);if(s){let o=n.value;s.forEach((e=>{if(e.includes(r)){const n=e.replace(new RegExp(`\\b${r}\\b`,"g"),`${t.restItems}[${i}]`);o=o.replace(e,n)}})),e.setAttribute(n.name,o)}}))})),e.appendChild(n)}e.removeAttribute("forEach")}this.#N(e)}))}catch(e){this.debug.error(`Error in for directive: ${e}`)}}#P(e){if(e)try{const t={token:null,flag:!1};o(e).forEach((e=>{if(e instanceof Element){if(e.hasAttribute("if")){t.flag=!1,t.token="if";const r=c(e.getAttribute("if"),this);if(!r)return void(e.outerHTML="");t.flag=r,e.removeAttribute("if")}else if(e.hasAttribute("elseIf")){if("if"!==t.token)return this.debug.error("Syntax Error: 'else if' statement must be preceded by an 'if' condition."),void(e.outerHTML="");if("if"===t.token){if(t.flag)return void(e.outerHTML="");const r=c(e.getAttribute("elseIf"),this);if(!r)return void(e.outerHTML="");t.flag=r,e.removeAttribute("elseIf")}}else if(e.hasAttribute("else")){if("if"!==t.token)return this.debug.error("Syntax Error: 'else' statement must be preceded by an 'if' or 'else if' condition."),void(e.outerHTML="");t.token=null,e.removeAttribute("else")}this.#P(e)}}))}catch(e){this.debug.error(`Error in if directive: ${e}`)}}#_(e){let t=a(e);t=Array.from(t).filter((e=>"param"===e.tagName.toLowerCase())),t.forEach((e=>{try{const t=e.getAttribute("value")||"",r=document.createTextNode(t);e.parentNode.insertBefore(r,e),e.remove()}catch(t){this.debug.error(`Error processing <param> element: ${e}`),this.debug.error(t)}}))}#R(e){a(e,"[src]").forEach((e=>{try{const t=e.getAttribute("src"),r=this.#m.getAbsolutePath(),n=this.#m.toAbsolutePath(t,r);e.src=n}catch(t){this.debug.error(`Error resolving src for element: ${e}`),this.debug.error(`${t}`)}}))}#$(e){e.querySelectorAll("*").forEach((e=>{Array.from(e.attributes).forEach((t=>{if(!t.name.endsWith("event"))return;const r=t.value.trim(),n=t.name.replace("event",""),i=e=>{c(r,this,{event:e})};e.addEventListener(n,i),this.#w.push({element:e,eventName:n,listener:i}),e.removeAttribute(t.name)}))}))}async preProcess(e){try{const t=e?.config;if(!t)return void console.error("Error in preProcess: config not provided");this.shadowRoot=this.attachShadow({mode:"open"}),this.#m=new r(t?.name,e),this.fps=t?.behavior?.fps??this.DEFAULT_FPS,this.priority=t?.behavior?.priority??this.DEFAULT_PRIORITY}catch(e){console.error("Error in preProcess:",e)}}async toProcess(e){}async atProcess(e){}async inProcess(e){}setFPS(e){this.fps=e,e<=0?this.pause():(this.deltaTime=1/e,this.resume())}pause(){this.paused=!0}resume(){this.paused=!1,this.__lastTime=performance.now()}notifyChanged(){e.notifyComponentChanged(this)}connectedCallback(){this.#m.isLazyLoading()?new IntersectionObserver(((e,t)=>{for(const r of e)r.isIntersecting&&(this.#I(),t.unobserve(this))}),{root:null,threshold:.1}).observe(this):this.#T().catch((e=>{this.debug?.error?.(`Component failed to initialize: ${e}`)}))}#I(){this.#T().then((()=>this.#k())).catch((e=>{this.debug?.error?.(`Component failed to initialize: ${e}`)}))}#k(){this.classList.add("loaded"),setTimeout((()=>{this.classList.remove("loaded"),this.classList.add("done")}),100),this.addEventListener("transitionend",(()=>{this.classList.remove("loaded"),this.classList.remove("done"),this.dispatchEvent(new CustomEvent("lazy-loaded",{bubbles:!0,composed:!0,detail:{element:this}}))}),{once:!0})}disconnectedCallback(){if(this.#w){for(const{element:e,eventName:t,listener:r}of this.#w)e.removeEventListener(t,r);this.#w=[]}e.remove(this)}adoptedCallback(){}attributeChangedCallback(e,t,r){}prependCssContent(e){const t=this.#m.get()?.files?.css?.content||"",r=e||"";this.#m.setCSSContent(`${r} ${t}`)}async getFileContent(e){return await u(e)}getAbsolutePath(){return this.#m.getAbsolutePath()}registerFunction(e,t){this[e]=t}}const A=new class{modularCubeConfig={};#M=null;#O={methods:{},vars:{}};#U=[];#q=null;#D=new Promise((e=>this.#q=e));registerMethod(e,t){this.#O.methods[e]=t}registerVariable(e,t){this.#O.vars[e]=t}#j(e){this.#M||(this.#M=e,this.#q?.(e))}#F(){return this.#D}async render(e){const t=await this.#F();return e?.(t),t}async update(e){const t=await this.#F();return"function"==typeof e?this.#U.includes(e)||this.#U.push(e):console.warn("Dom.update expects a function, got:",e),t}#H(){e.get().forEach((({tag:e,type:t})=>{customElements.get(e)||customElements.define(e,t)}))}#z(e){return Array.isArray(e)&&e.every((e=>"object"==typeof e&&null!==e&&"string"==typeof e.tag&&"function"==typeof e.type))}#Q(e){console.warn(`Config Warning: ${e}`)}#B(){const e=new CSSStyleSheet;e.replaceSync("\n            *:not(head, script, style, link, br, hr) {\n                display: block;\n                margin: 0;\n                padding: 0;\n                border:0;\n                font-size: inherit;\n                font-weight: inherit;\n                color: inherit;\n                background-color: transparent;\n                background: none;\n                text-decoration: inherit;\n                list-style-type: none;\n                outline: none;\n                cursor: default;\n            }\n            head, script { display: none !important; }\n            *::placeholder { color: black; opacity: 0.25; }\n            html { position: absolute !important; width: 100vw !important; height: 100vh !important; overflow-x: hidden !important; overflow-y: hidden !important; }\n            body { position: relative !important; width: 100%; height: 100%; overflow-y: auto; scrollbar-width: none; }\n        "),document.adoptedStyleSheets=[...document.adoptedStyleSheets,e];const t=Element.prototype.attachShadow;Element.prototype.attachShadow=function(r){const n=t.call(this,r);return n.adoptedStyleSheets=[...n.adoptedStyleSheets,e],n},window.__GLOBAL_SHEET__=e}async init(...t){let r=null,n=t;this.#z(t[0])&&(e.registerAll(t[0]),n=t.slice(1)),this.#z(t[0])||"string"==typeof t[0]||(r="./app.config.json"),t[0]&&"string"==typeof t[0]&&t[0].toLowerCase().endsWith(".json")&&(r=t[0],n=t.slice(1));for(let e=0;e<n.length;e++){const t=n[e];if("function"==typeof t)try{const e=t();e instanceof Promise&&await e}catch(t){console.error(`Error running initializer function at position ${e+1}:`,t)}}if(r){const e=await async function(e){if(h.has(e))return h.get(e);try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const r=await t.json();return h.set(e,r),r}catch(e){return console.error("Failed to load JSON:",e),null}}(r),t=e?.modularCube;if(!t||"object"!=typeof t)return void this.#Q("Missing or invalid 'modularCube' configuration.");if(this.modularCubeConfig=t,!t?.components||!t?.components?.length)return void this.#Q("'components' is missing from configuration.");await this.#X()}if(this.#H(),this.modularCubeConfig?.application?.name&&!customElements.get(this.modularCubeConfig?.application?.name)){if(!this.modularCubeConfig?.application)return void this.#Q("'application' is missing from configuration.");this.#V()}this.modularCubeConfig?.normalizeStyle&&this.#B()}#V(){const e=this.modularCubeConfig?.application,t=this,r=this.#O;customElements.define("app-root",class extends C{preProcess(){super.preProcess({config:e}),Object.assign(this,r.vars),Object.assign(Object.getPrototypeOf(this),r.methods)}async toProcess(e){this.template?.text&&e.insertAdjacentHTML("beforeend",this.template.text)}async atProcess(e){t.#j(this)}async inProcess(e){for(const e of t.#U)try{await e(this)}catch(e){console.error("Error in Dom.update callback:",e)}}})}async#X(){for(const t of this.modularCubeConfig?.components){const{tag:r,path:n}=t;try{const t=await import(new URL(n,window.location.href).href);let i=n.replace(/^.*\/([^/]+)\.js$/,"$1"),s=t[i]||t.default;if(!s){console.warn(`Class "${i}" not found in module: ${n}`);continue}e.register({tag:r,type:s})}catch(e){console.error(`Error importing or defining component from ${n}:`,e)}}}},S=new class{constructor(){this.observables=[]}subscribe(e,t){if("function"!=typeof t)throw new Error(typeof t+" is not a valid argument for subscribe method, expected a function instead");this.observables=[...this.observables,{name:e,subscriber:t}]}unsubscribe(e){if("string"!=typeof e)throw new Error(typeof e+" is not a valid argument for unsubscribe method, expected a string instead");this.observables=this.observables.filter((t=>t.name!==e))}publish(e,t){const r=this.observables.find((t=>t.name===e));if(!r)throw new Error(`No subscribers found for event: ${e}`);r.subscriber(t)}};class L{static int(e){if("number"!=typeof e||!Number.isInteger(e))throw new TypeError("Expected integer, got "+typeof e);return{value:e,add(e){if("number"!=typeof e)throw new TypeError("Addend must be a number");return this.value+=e,this},subtract(e){if("number"!=typeof e)throw new TypeError("Subtrahend must be a number");return this.value-=e,this},multiply(e){if("number"!=typeof e)throw new TypeError("Multiplier must be a number");return this.value*=e,this},divide(e){if("number"!=typeof e||0===e)throw new TypeError("Divisor must be a non-zero number");return this.value=Math.floor(this.value/e),this},toString(){return this.value.toString()}}}static float(e){if("number"!=typeof e||Number.isNaN(e)||!isFinite(e))throw new TypeError("Expected float, got "+typeof e);return{value:e,add(e){if("number"!=typeof e)throw new TypeError("Addend must be a number");return this.value+=e,this},subtract(e){if("number"!=typeof e)throw new TypeError("Subtrahend must be a number");return this.value-=e,this},multiply(e){if("number"!=typeof e)throw new TypeError("Multiplier must be a number");return this.value*=e,this},divide(e){if("number"!=typeof e||0===e)throw new TypeError("Divisor must be a non-zero number");return this.value/=e,this},toFixed(e){if(!Number.isInteger(e)||e<0)throw new TypeError("Digits must be a non-negative integer");return this.value.toFixed(e)},toString(){return this.value.toString()}}}static number(e){if("number"!=typeof e||!isFinite(e))throw new TypeError("Expected a finite number, got "+typeof e);return Number.isInteger(e)?L.int(e):L.float(e)}static bool(e){if("boolean"!=typeof e)throw new TypeError("Expected boolean, got "+typeof e);return{value:e,and(e){if("boolean"!=typeof e)throw new TypeError("Argument must be boolean");return this.value=this.value&&e,this},or(e){if("boolean"!=typeof e)throw new TypeError("Argument must be boolean");return this.value=this.value||e,this},not(){return this.value=!this.value,this},toString(){return this.value.toString()}}}static char(e){if("string"!=typeof e||1!==e.length)throw new TypeError(`Expected single character, got "${e}"`);return{value:e,isUpperCase(){return this.value===this.value.toUpperCase()},isLowerCase(){return this.value===this.value.toLowerCase()},toUpperCase(){return this.value=this.value.toUpperCase(),this},toLowerCase(){return this.value=this.value.toLowerCase(),this},toString(){return this.value}}}static string(e){if("string"!=typeof e)throw new TypeError("Expected string, got "+typeof e);return{value:e,length(){return this.value.length},toUpperCase(){return this.value=this.value.toUpperCase(),this},toLowerCase(){return this.value=this.value.toLowerCase(),this},includes(e){if("string"!=typeof e)throw new TypeError("Argument must be string");return this.value.includes(e)},concat(e){if("string"!=typeof e)throw new TypeError("Argument must be string");return this.value+=e,this},toString(){return this.value}}}static array(e){if(!Array.isArray(e))throw new TypeError("Expected array, got "+typeof e);return{value:e,length(){return this.value.length},push(e){return this.value.push(e),this},pop(){return this.value.pop()},map(e){return this.value=this.value.map(e),this},filter(e){return this.value=this.value.filter(e),this},toString(){return this.value.toString()}}}static map(e){if("object"!=typeof e||null===e||Array.isArray(e))throw new TypeError("Expected plain object for Map, got "+typeof e);return{value:e,get(e){return this.value[e]},set(e,t){return this.value[e]=t,this},has(e){return Object.prototype.hasOwnProperty.call(this.value,e)},delete(e){return!!this.has(e)&&(delete this.value[e],!0)},keys(){return Object.keys(this.value)},values(){return Object.values(this.value)},entries(){return Object.entries(this.value)},map(e){const t={};for(const[r,n]of Object.entries(this.value)){const i=e(r,n);Array.isArray(i)&&2===i.length?t[i[0]]=i[1]:t[r]=i}return this.value=t,this},toString(){return JSON.stringify(this.value)}}}}class N{static stringify(e){try{return JSON.stringify(e).replace(/"/g,"'")}catch(e){throw new Error("Value cannot be stringified.")}}static parse(e){if("string"!=typeof e)throw new TypeError("parse() expects a string input.");try{return JSON.parse(e.replace(/'/g,'"'))}catch(e){throw new Error("Invalid string format for parsing.")}}}const P=A,_=class{constructor(e=[],t,{base:r="",mode:n="history",guards:i=[],hooks:s={},defaultTransition:o={type:"fade",duration:300},loadingIndicator:a=null}={}){this.routes=e,this.outlet=t,this.base=r.replace(/\/$/,""),this.mode=n,this.globalGuards=i,this.hooks=s,this.defaultTransition=o,this.loadingIndicator=a,this.current=null,this.navToken=0,this.cache=new Map,this.handlePopState=this.handlePopState.bind(this),this.handleLinkClick=this.handleLinkClick.bind(this),window.addEventListener("popstate",this.handlePopState),document.addEventListener("click",this.handleLinkClick,!0),this.navigate(this.#G(),{replace:!0})}#G(){if("hash"===this.mode){const e=location.hash.startsWith("#/")?location.hash.slice(1):"/",[t,r]=e.split("?");return{path:this.#W(t),query:this.#J(r)}}let e=location.pathname;this.base&&e.startsWith(this.base)&&(e=e.slice(this.base.length)||"/");const[t,r]=(e+location.search).split("?");return{path:this.#W(t),query:this.#J(r)}}#W(e){return e.replace(/\/+$/,"")||"/"}#J(e){const t={};if(!e)return t;for(const[r,n]of new URLSearchParams(e))t[r]=n;return t}#Y(e,t,r){const n=new URLSearchParams(t).toString(),i=this.base+e+(n?`?${n}`:"");r?history.replaceState({},"",i):history.pushState({},"",i)}async navigate(e,t={}){const r=++this.navToken,n="string"==typeof e?e.split("?")[0]:e.path,i=t.query??("string"==typeof e?this.#J(e.split("?")[1]):e.query),s=this.#Z(n);if(!s)return this.#K();if(s.redirectTo)return void(window.location.href=s.redirectTo);const o={from:this.current,to:s,path:n,params:s.params,query:i,router:this};this.hooks.beforeNavigate&&!1===await this.hooks.beforeNavigate(o)||await this.#ee(o)&&(this.#Y(n,i,t.replace),this.current=s,this.loadingIndicator&&(this.loadingIndicator.style.display="block"),await this.#te(s,this.outlet,o,r),r===this.navToken&&(this.loadingIndicator&&(this.loadingIndicator.style.display="none"),this.hooks.afterNavigate?.(o),window.scrollTo(0,0)))}handlePopState(){this.navigate(this.#G(),{replace:!0})}handleLinkClick(e){const t=e.composedPath().find((e=>"A"===e?.tagName));if(!t)return;const r=t.getAttribute("href");!r||r.startsWith("http")||r.startsWith("mailto:")||"_blank"===t.target||(e.preventDefault(),this.navigate(r))}async#ee(e){const t=[...this.globalGuards,e.route?.guard].filter(Boolean);for(const r of t)if(!await r(e))return!1;return!0}#Z(e,t=this.routes,r=""){for(const n of t){const t=[],i=this.#W(r+n.path),s=new RegExp("^"+i.replace(/:[^/]+/g,(e=>(t.push(e.slice(1)),"([^/]+)")))+"(?:/|$)"),o=e.match(s);if(!o)continue;const a={};t.forEach(((e,t)=>a[e]=o[t+1]));const l=e.slice(o[0].length-1)||"/",h={...n,params:a};if(n.children){const e=this.#Z(l,n.children,i);if(e)return{...h,child:e}}return h}return t.find((e=>"*"===e.path))||null}async#te(e,t,r,n){if(!t||n!==this.navToken)return;let i,s=t.firstElementChild;if(e.keepAlive&&this.cache.has(e.path)&&(i=this.cache.get(e.path)),i)i.routeParams=e.params,i.routeQuery=r.query,i.onRouteUpdate?.(r);else{if(!e.component&&!e.html)return void console.error(`[Router] Route ${e.path} must have 'component' or 'html'`);if(e.load&&await e.load(),e.component)i=document.createElement(e.component),i.routeParams=e.params,i.routeQuery=r.query,i.onRouteEnter?.(r);else if(e.html){const t=await fetch(e.html).then((e=>e.text()));i=(new DOMParser).parseFromString(t,"text/html").body}e.keepAlive&&this.cache.set(e.path,i)}await this.#re(t,s,i,e)}async#re(e,t,r,n){const i=n.transition||this.defaultTransition,s=i.duration??300,o=i.type??"fade";t?(e.appendChild(r),r.style.transition=`all ${s}ms ease`,t.style.transition=`all ${s}ms ease`,"fade"===o?r.style.opacity=0:"slide-left"===o&&(r.style.transform="translateX(100%)"),await new Promise((e=>requestAnimationFrame(e))),"fade"===o?(r.style.opacity=1,t.style.opacity=0):"slide-left"===o&&(r.style.transform="translateX(0)",t.style.transform="translateX(-100%)"),await new Promise((e=>setTimeout(e,s))),t?.parentNode===e&&e.removeChild(t),r.style.opacity="",r.style.transform="",r.style.transition=""):e.replaceChildren(r)}#K(){const e=this.routes.find((e=>"*"===e.path));e&&this.#te(e,this.outlet,{},this.navToken)}},R=S,$=C,x=class{static insertNode(e,t,r={}){let n=[];if("string"==typeof t){const e=document.createElement("div");e.innerHTML=t,n=Array.from(e.childNodes)}else if(t instanceof Node)n=[t];else{if(!Array.isArray(t))throw new Error("Content must be a string, Node, or array of Nodes.");n=t}const i=r.position||"end";for(const t of n)switch(i){case"start":e.insertBefore(t,e.firstChild);break;case"end":e.appendChild(t);break;case"before":if(!r.reference)throw new Error('Reference element required for "before" position.');r.reference.parentNode.insertBefore(t,r.reference);break;case"after":if(!r.reference)throw new Error('Reference element required for "after" position.');r.reference.after(t);break;case"index":const n=r.index??e.children.length;n>=e.children.length?e.appendChild(t):e.insertBefore(t,e.children[n]);break;default:throw new Error("Invalid position: "+i)}}}.insertNode,I=L.int,k=L.float,M=L.number,O=L.bool,U=L.char,q=L.string,D=L.array,j=L.map,F=class{static tween(e,t,r,n,i){const s=t-e;let o=null;requestAnimationFrame((function t(a){o||(o=a);const l=a-o,h=Math.min(l/r,1);n(e+s*h),h<1?requestAnimationFrame(t):i&&i()}))}}.tween,H=N.stringify,z=N.parse;export{P as Dom,$ as HTMLComponent,R as Observable,_ as Router,D as array,O as bool,U as char,k as float,x as insertNode,I as int,j as map,M as number,z as parse,q as string,H as stringify,F as tween};